# PSOCé¡¹ç›®æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†PSOCï¼ˆPhotoshop-like image editorï¼‰é¡¹ç›®çš„æ•´ä½“æ¶æ„è®¾è®¡ã€ä»£ç ç»“æ„å’Œæ¨¡å—å…³ç³»ã€‚PSOCæ˜¯ä¸€ä¸ªç”¨Rustæ„å»ºçš„ä¸“ä¸šçº§å›¾åƒç¼–è¾‘å™¨ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„è½¯ä»¶æ¶æ„å’Œè®¾è®¡æ¨¡å¼ã€‚

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ¶æ„åŸåˆ™
- **æ¨¡å—åŒ–è®¾è®¡ï¼š** æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»å’ŒèŒè´£åˆ’åˆ†
- **ç±»å‹å®‰å…¨ï¼š** åˆ©ç”¨Rustç±»å‹ç³»ç»Ÿä¿è¯å†…å­˜å’Œçº¿ç¨‹å®‰å…¨
- **å¯æ‰©å±•æ€§ï¼š** æ”¯æŒæ’ä»¶ç³»ç»Ÿå’ŒåŠŸèƒ½æ‰©å±•
- **é«˜æ€§èƒ½ï¼š** å¹¶è¡Œå¤„ç†å’Œç¼“å­˜ä¼˜åŒ–
- **è·¨å¹³å°ï¼š** åŸç”Ÿè·¨å¹³å°æ”¯æŒ

### æ¶æ„å±‚æ¬¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   åº”ç”¨ç¨‹åº   â”‚ â”‚    ç”»å¸ƒ     â”‚ â”‚   å¯¹è¯æ¡†    â”‚ â”‚  ä¸»é¢˜   â”‚ â”‚
â”‚  â”‚ Application â”‚ â”‚   Canvas    â”‚ â”‚  Dialogs    â”‚ â”‚ Theme   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   å·¥å…·ç³»ç»Ÿ   â”‚ â”‚   å‘½ä»¤ç³»ç»Ÿ   â”‚ â”‚   å¿«æ·é”®    â”‚ â”‚  æ’ä»¶   â”‚ â”‚
â”‚  â”‚    Tools    â”‚ â”‚  Commands   â”‚ â”‚ Shortcuts   â”‚ â”‚Plugins  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒå±‚ (Core Layer)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   æ–‡æ¡£æ¨¡å‹   â”‚ â”‚   æ¸²æŸ“å¼•æ“   â”‚ â”‚  å›¾åƒå¤„ç†   â”‚ â”‚ æ–‡ä»¶IO  â”‚ â”‚
â”‚  â”‚  Document   â”‚ â”‚  Rendering  â”‚ â”‚Image Processâ”‚ â”‚File I/O â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   æ•°æ®ç»“æ„   â”‚ â”‚   å‡ ä½•è®¡ç®—   â”‚ â”‚   é¢œè‰²ç®¡ç†   â”‚ â”‚  å·¥å…·   â”‚ â”‚
â”‚  â”‚    Data     â”‚ â”‚  Geometry   â”‚ â”‚    Color    â”‚ â”‚ Utils   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ é¡¹ç›®ç»“æ„

### Workspaceç»„ç»‡
```
psoc/
â”œâ”€â”€ Cargo.toml                 # ä¸»é¡¹ç›®é…ç½®
â”œâ”€â”€ src/                       # ä¸»åº”ç”¨ç¨‹åºä»£ç 
â”œâ”€â”€ crates/                    # å­crateåº“
â”‚   â”œâ”€â”€ psoc-core/            # æ ¸å¿ƒæ•°æ®ç»“æ„å’Œç®—æ³•
â”‚   â”œâ”€â”€ psoc-image-processing/ # å›¾åƒå¤„ç†ç®—æ³•
â”‚   â”œâ”€â”€ psoc-file-formats/     # æ–‡ä»¶æ ¼å¼æ”¯æŒ
â”‚   â”œâ”€â”€ psoc-ui-toolkit/       # UIç»„ä»¶åº“
â”‚   â””â”€â”€ psoc-plugins/          # æ’ä»¶ç³»ç»Ÿ
â”œâ”€â”€ tests/                     # é›†æˆæµ‹è¯•
â”œâ”€â”€ examples/                  # ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ docs/                      # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ scripts/                   # æ„å»ºå’Œæ‰“åŒ…è„šæœ¬
â””â”€â”€ resources/                 # èµ„æºæ–‡ä»¶
```

### ä¸»åº”ç”¨ç¨‹åºç»“æ„
```
src/
â”œâ”€â”€ main.rs                    # ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ lib.rs                     # åº“å…¥å£ç‚¹
â”œâ”€â”€ app/                       # åº”ç”¨ç¨‹åºæ ¸å¿ƒ
â”œâ”€â”€ ui/                        # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ application.rs         # ä¸»åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ canvas.rs             # ç”»å¸ƒç»„ä»¶
â”‚   â”œâ”€â”€ dialogs/              # å¯¹è¯æ¡†
â”‚   â”œâ”€â”€ components.rs         # UIç»„ä»¶
â”‚   â”œâ”€â”€ icons.rs              # å›¾æ ‡ç³»ç»Ÿ
â”‚   â””â”€â”€ theme.rs              # ä¸»é¢˜ç³»ç»Ÿ
â”œâ”€â”€ tools/                     # å·¥å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ tool_trait.rs         # å·¥å…·æ¥å£
â”‚   â”œâ”€â”€ tool_manager.rs       # å·¥å…·ç®¡ç†å™¨
â”‚   â””â”€â”€ tools.rs              # å…·ä½“å·¥å…·å®ç°
â”œâ”€â”€ commands/                  # å‘½ä»¤ç³»ç»Ÿ
â”œâ”€â”€ shortcuts/                 # å¿«æ·é”®ç³»ç»Ÿ
â”œâ”€â”€ rendering/                 # æ¸²æŸ“æ¨¡å—
â”œâ”€â”€ file_io/                   # æ–‡ä»¶IO
â”œâ”€â”€ image_processing/          # å›¾åƒå¤„ç†
â”œâ”€â”€ preferences/               # ç”¨æˆ·åå¥½
â”œâ”€â”€ i18n/                      # å›½é™…åŒ–
â”œâ”€â”€ plugins/                   # æ’ä»¶æ¥å£
â””â”€â”€ utils/                     # å·¥å…·å‡½æ•°
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. æ–‡æ¡£æ¨¡å‹ (Document Model)

**ä½ç½®ï¼š** `crates/psoc-core/src/document.rs`

**æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š**
```rust
pub struct Document {
    pub id: Uuid,                    // æ–‡æ¡£å”¯ä¸€æ ‡è¯†
    pub metadata: DocumentMetadata,  // æ–‡æ¡£å…ƒæ•°æ®
    pub size: Size,                  // æ–‡æ¡£å°ºå¯¸
    pub resolution: Resolution,      // åˆ†è¾¨ç‡
    pub color_mode: ColorMode,       // é¢œè‰²æ¨¡å¼
    pub color_space: DocumentColorSpace, // é¢œè‰²ç©ºé—´
    pub icc_profile: Option<IccProfile>, // ICCé…ç½®æ–‡ä»¶
    pub background_color: RgbaPixel, // èƒŒæ™¯è‰²
    pub layers: Vec<Layer>,          // å›¾å±‚åˆ—è¡¨
    pub active_layer_index: Option<usize>, // æ´»åŠ¨å›¾å±‚
    pub canvas_bounds: Rect,         // ç”»å¸ƒè¾¹ç•Œ
    pub selection: Selection,        // å½“å‰é€‰åŒº
    pub command_history: CommandHistory, // å‘½ä»¤å†å²
}
```

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- æ”¯æŒå¤šå›¾å±‚ç»“æ„
- å®Œæ•´çš„é¢œè‰²ç®¡ç†
- æ’¤é”€/é‡åšç³»ç»Ÿ
- é€‰åŒºç®¡ç†
- å…ƒæ•°æ®æ”¯æŒ

### 2. å›¾å±‚ç³»ç»Ÿ (Layer System)

**ä½ç½®ï¼š** `crates/psoc-core/src/layer.rs`

**å›¾å±‚ç±»å‹ï¼š**
```rust
pub enum LayerType {
    Pixel,                          // åƒç´ å›¾å±‚
    Adjustment(AdjustmentType),     // è°ƒæ•´å›¾å±‚
    SmartObject(SmartObjectContent), // æ™ºèƒ½å¯¹è±¡
    Text(TextData),                 // æ–‡æœ¬å›¾å±‚
    Shape(ShapeData),               // å½¢çŠ¶å›¾å±‚
    Group,                          // å›¾å±‚ç»„
}
```

**å›¾å±‚ç»“æ„ï¼š**
```rust
pub struct Layer {
    pub id: Uuid,                   // å›¾å±‚ID
    pub name: String,               // å›¾å±‚åç§°
    pub layer_type: LayerType,      // å›¾å±‚ç±»å‹
    pub pixel_data: Option<PixelData>, // åƒç´ æ•°æ®
    pub visible: bool,              // å¯è§æ€§
    pub opacity: f32,               // ä¸é€æ˜åº¦
    pub blend_mode: BlendMode,      // æ··åˆæ¨¡å¼
    pub offset: Point,              // ä½ç½®åç§»
    pub transform: Transform,       // å˜æ¢çŸ©é˜µ
    pub bounds: Rect,               // å›¾å±‚è¾¹ç•Œ
    pub locked: bool,               // é”å®šçŠ¶æ€
    pub mask: Option<PixelData>,    // å›¾å±‚è’™ç‰ˆ
}
```

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- æ”¯æŒ16ç§æ··åˆæ¨¡å¼
- éç ´åæ€§ç¼–è¾‘
- æ™ºèƒ½å¯¹è±¡æ”¯æŒ
- å›¾å±‚è’™ç‰ˆ
- å˜æ¢ç³»ç»Ÿ

### 3. å·¥å…·ç³»ç»Ÿ (Tool System)

**ä½ç½®ï¼š** `src/tools/`

**å·¥å…·æ¥å£ï¼š**
```rust
pub trait Tool: Debug + Send + Sync {
    fn id(&self) -> &'static str;
    fn name(&self) -> &'static str;
    fn description(&self) -> &'static str;
    fn activate(&mut self) -> ToolResult<()>;
    fn deactivate(&mut self) -> ToolResult<()>;
    fn handle_event(&mut self, event: ToolEvent, document: &mut Document, state: &mut ToolState) -> ToolResult<()>;
    fn cursor(&self) -> ToolCursor;
    fn options(&self) -> Vec<ToolOption>;
    fn set_option(&mut self, name: &str, value: ToolOptionValue) -> ToolResult<()>;
    fn get_option(&self, name: &str) -> Option<ToolOptionValue>;
}
```

**å·¥å…·ç±»å‹ï¼š**
- **é€‰æ‹©å·¥å…·ï¼š** Select, EllipseSelect, LassoSelect, MagicWand
- **ç»˜ç”»å·¥å…·ï¼š** Brush, Eraser
- **ç¼–è¾‘å·¥å…·ï¼š** Move, Transform, Crop
- **å½¢çŠ¶å·¥å…·ï¼š** Rectangle, Ellipse, Line, Polygon
- **å…¶ä»–å·¥å…·ï¼š** Text, Gradient, Eyedropper

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- ç»Ÿä¸€çš„å·¥å…·æ¥å£
- äº‹ä»¶é©±åŠ¨æ¶æ„
- åŠ¨æ€é€‰é¡¹é…ç½®
- çŠ¶æ€ç®¡ç†

### 4. å‘½ä»¤ç³»ç»Ÿ (Command System)

**ä½ç½®ï¼š** `src/commands/` å’Œ `crates/psoc-core/src/command.rs`

**å‘½ä»¤æ¥å£ï¼š**
```rust
pub trait Command: Debug + Send + Sync {
    fn id(&self) -> Uuid;
    fn description(&self) -> &str;
    fn execute(&self, document: &mut Document) -> Result<()>;
    fn undo(&self, document: &mut Document) -> Result<()>;
    fn timestamp(&self) -> SystemTime;
    fn modifies_document(&self) -> bool;
}
```

**å‘½ä»¤ç±»å‹ï¼š**
- **å›¾å±‚å‘½ä»¤ï¼š** AddLayer, DeleteLayer, MoveLayer
- **ç»˜ç”»å‘½ä»¤ï¼š** BrushStroke, EraseStroke
- **è°ƒæ•´å‘½ä»¤ï¼š** BrightnessContrast, HSLAdjustment
- **å˜æ¢å‘½ä»¤ï¼š** Scale, Rotate, Translate
- **é€‰æ‹©å‘½ä»¤ï¼š** CreateSelection, ModifySelection
- **æ™ºèƒ½å¯¹è±¡å‘½ä»¤ï¼š** CreateSmartObject, UpdateSmartObject

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- å®Œæ•´çš„æ’¤é”€/é‡åšæ”¯æŒ
- å‘½ä»¤ç»„åˆå’Œæ‰¹å¤„ç†
- å†å²è®°å½•ç®¡ç†
- å†…å­˜ä¼˜åŒ–

### 5. æ¸²æŸ“å¼•æ“ (Rendering Engine)

**ä½ç½®ï¼š** `crates/psoc-core/src/rendering.rs`

**æ¸²æŸ“å™¨ç»“æ„ï¼š**
```rust
pub struct RenderEngine {
    parallel_enabled: bool,              // å¹¶è¡Œå¤„ç†
    tile_size: u32,                     // ç“¦ç‰‡å¤§å°
    adjustment_registry: AdjustmentRegistry, // è°ƒæ•´æ³¨å†Œè¡¨
    smart_object_manager: SmartObjectManager, // æ™ºèƒ½å¯¹è±¡ç®¡ç†å™¨
}
```

**æ¸²æŸ“æµç¨‹ï¼š**
1. **å›¾å±‚æ”¶é›†ï¼š** æ”¶é›†å¯è§å›¾å±‚
2. **é¢„å¤„ç†ï¼š** åº”ç”¨å˜æ¢å’Œè°ƒæ•´
3. **åˆæˆï¼š** æŒ‰æ··åˆæ¨¡å¼åˆæˆ
4. **åå¤„ç†ï¼š** åº”ç”¨æ»¤é•œå’Œæ•ˆæœ
5. **è¾“å‡ºï¼š** ç”Ÿæˆæœ€ç»ˆå›¾åƒ

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- å¹¶è¡Œæ¸²æŸ“æ”¯æŒ
- æ™ºèƒ½ç¼“å­˜æœºåˆ¶
- 16ç§æ··åˆæ¨¡å¼
- é«˜è´¨é‡æ’å€¼

### 6. ç”¨æˆ·ç•Œé¢ (User Interface)

**ä½ç½®ï¼š** `src/ui/`

**ä¸»åº”ç”¨ç¨‹åºï¼š**
```rust
pub struct PsocApp {
    state: AppState,                    // åº”ç”¨çŠ¶æ€
    document: Option<Document>,         // å½“å‰æ–‡æ¡£
    tool_manager: ToolManager,          // å·¥å…·ç®¡ç†å™¨
    theme: PsocTheme,                   // ä¸»é¢˜
    dialogs: DialogManager,             // å¯¹è¯æ¡†ç®¡ç†å™¨
}
```

**UIç»„ä»¶ï¼š**
- **èœå•æ ï¼š** æ–‡ä»¶ã€ç¼–è¾‘ã€å›¾åƒã€å›¾å±‚ã€é€‰æ‹©ã€æ»¤é•œç­‰
- **å·¥å…·æ ï¼š** å·¥å…·é€‰æ‹©å’Œå¿«é€Ÿæ“ä½œ
- **ç”»å¸ƒï¼š** å›¾åƒæ˜¾ç¤ºå’Œç¼–è¾‘åŒºåŸŸ
- **é¢æ¿ï¼š** å›¾å±‚ã€å·¥å…·é€‰é¡¹ã€é¢œè‰²ã€å†å²è®°å½•ç­‰
- **çŠ¶æ€æ ï¼š** çŠ¶æ€ä¿¡æ¯å’Œè¿›åº¦æ˜¾ç¤º

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- åŸºäºiced GUIæ¡†æ¶
- å“åº”å¼è®¾è®¡
- ä¸»é¢˜ç³»ç»Ÿ
- å›½é™…åŒ–æ”¯æŒ

## ğŸ”„ æ¨¡å—å…³ç³»å’Œæ•°æ®æµ

### æ ¸å¿ƒæ•°æ®æµ
```
ç”¨æˆ·è¾“å…¥ â†’ UIäº‹ä»¶ â†’ å·¥å…·å¤„ç† â†’ å‘½ä»¤ç”Ÿæˆ â†’ æ–‡æ¡£ä¿®æ”¹ â†’ æ¸²æŸ“æ›´æ–° â†’ UIæ˜¾ç¤º
```

### æ¨¡å—ä¾èµ–å…³ç³»
```
UI Layer
â”œâ”€â”€ ä¾èµ– Business Layer
â”œâ”€â”€ ä¾èµ– Core Layer (é—´æ¥)
â””â”€â”€ ä¾èµ– Infrastructure (é—´æ¥)

Business Layer
â”œâ”€â”€ ä¾èµ– Core Layer
â””â”€â”€ ä¾èµ– Infrastructure

Core Layer
â””â”€â”€ ä¾èµ– Infrastructure

Infrastructure
â””â”€â”€ æ— å¤–éƒ¨ä¾èµ–
```

### å…³é”®æ¥å£
1. **Tool â†” Documentï¼š** å·¥å…·é€šè¿‡å‘½ä»¤ä¿®æ”¹æ–‡æ¡£
2. **Command â†” Documentï¼š** å‘½ä»¤ç›´æ¥æ“ä½œæ–‡æ¡£æ•°æ®
3. **RenderEngine â†” Documentï¼š** æ¸²æŸ“å¼•æ“è¯»å–æ–‡æ¡£ç”Ÿæˆå›¾åƒ
4. **UI â†” Toolï¼š** UIå°†äº‹ä»¶ä¼ é€’ç»™å·¥å…·ï¼Œè·å–å·¥å…·çŠ¶æ€
5. **UI â†” Documentï¼š** UIæ˜¾ç¤ºæ–‡æ¡£å†…å®¹ï¼Œå“åº”æ–‡æ¡£å˜åŒ–

## ğŸ¯ è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. å‘½ä»¤æ¨¡å¼ (Command Pattern)
- **åº”ç”¨ï¼š** æ’¤é”€/é‡åšç³»ç»Ÿ
- **å®ç°ï¼š** Command traitå’ŒCommandHistory
- **ä¼˜åŠ¿ï¼š** æ“ä½œå¯é€†ã€æ‰¹å¤„ç†ã€å®å½•åˆ¶

### 2. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
- **åº”ç”¨ï¼š** å·¥å…·ç³»ç»Ÿã€è°ƒæ•´ç³»ç»Ÿ
- **å®ç°ï¼š** Tool traitã€Adjustment trait
- **ä¼˜åŠ¿ï¼š** ç®—æ³•å¯æ›¿æ¢ã€æ˜“äºæ‰©å±•

### 3. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)
- **åº”ç”¨ï¼š** UIäº‹ä»¶å¤„ç†
- **å®ç°ï¼š** icedæ¶ˆæ¯ç³»ç»Ÿ
- **ä¼˜åŠ¿ï¼š** æ¾è€¦åˆã€äº‹ä»¶é©±åŠ¨

### 4. å·¥å‚æ¨¡å¼ (Factory Pattern)
- **åº”ç”¨ï¼š** å›¾å±‚åˆ›å»ºã€å·¥å…·åˆ›å»º
- **å®ç°ï¼š** LayerFactoryã€ToolManager
- **ä¼˜åŠ¿ï¼š** å¯¹è±¡åˆ›å»ºç»Ÿä¸€ç®¡ç†

### 5. å•ä¾‹æ¨¡å¼ (Singleton Pattern)
- **åº”ç”¨ï¼š** åº”ç”¨ç¨‹åºçŠ¶æ€ã€é…ç½®ç®¡ç†
- **å®ç°ï¼š** å…¨å±€çŠ¶æ€ç®¡ç†
- **ä¼˜åŠ¿ï¼š** çŠ¶æ€ä¸€è‡´æ€§

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. å¹¶è¡Œå¤„ç†
- **å›¾åƒå¤„ç†ï¼š** ä½¿ç”¨rayonè¿›è¡Œå¹¶è¡Œåƒç´ å¤„ç†
- **æ¸²æŸ“ï¼š** ç“¦ç‰‡åŒ–å¹¶è¡Œæ¸²æŸ“
- **æ–‡ä»¶IOï¼š** å¼‚æ­¥æ–‡ä»¶æ“ä½œ

### 2. ç¼“å­˜æœºåˆ¶
- **æ™ºèƒ½å¯¹è±¡ï¼š** LRUç¼“å­˜ç­–ç•¥
- **æ¸²æŸ“ç»“æœï¼š** å›¾å±‚æ¸²æŸ“ç¼“å­˜
- **è°ƒæ•´é¢„è§ˆï¼š** å®æ—¶é¢„è§ˆç¼“å­˜

### 3. å†…å­˜ç®¡ç†
- **é›¶æ‹·è´ï¼š** å°½å¯èƒ½é¿å…æ•°æ®æ‹·è´
- **å¼•ç”¨è®¡æ•°ï¼š** å…±äº«æ•°æ®ä½¿ç”¨Arc
- **å†…å­˜æ± ï¼š** å¤§å¯¹è±¡å†…å­˜å¤ç”¨

### 4. ç®—æ³•ä¼˜åŒ–
- **SIMDï¼š** å‘é‡åŒ–å›¾åƒå¤„ç†
- **æŸ¥æ‰¾è¡¨ï¼š** é¢„è®¡ç®—å¸¸ç”¨å‡½æ•°
- **ç©ºé—´ç´¢å¼•ï¼š** å¿«é€Ÿç¢°æ’æ£€æµ‹

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶ç³»ç»Ÿ
- **æ¥å£ï¼š** æ ‡å‡†åŒ–æ’ä»¶API
- **åŠ è½½ï¼š** åŠ¨æ€åº“åŠ è½½
- **æ²™ç®±ï¼š** WASMå®‰å…¨æ‰§è¡Œç¯å¢ƒ
- **è„šæœ¬ï¼š** Luaè„šæœ¬æ”¯æŒ

### 2. æ–‡ä»¶æ ¼å¼
- **æ¨¡å—åŒ–ï¼š** ç‹¬ç«‹çš„æ ¼å¼å¤„ç†crate
- **å¯æ‰©å±•ï¼š** æ–°æ ¼å¼æ˜“äºæ·»åŠ 
- **æ ‡å‡†åŒ–ï¼š** ç»Ÿä¸€çš„æ ¼å¼æ¥å£

### 3. å·¥å…·æ‰©å±•
- **æ’ä»¶å·¥å…·ï¼š** ç¬¬ä¸‰æ–¹å·¥å…·æ”¯æŒ
- **è‡ªå®šä¹‰å·¥å…·ï¼š** ç”¨æˆ·è‡ªå®šä¹‰å·¥å…·
- **å·¥å…·ç»„åˆï¼š** å¤åˆå·¥å…·æ”¯æŒ

## ğŸ“‹ æ€»ç»“

PSOCé¡¹ç›®é‡‡ç”¨äº†ç°ä»£åŒ–çš„è½¯ä»¶æ¶æ„è®¾è®¡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### æŠ€æœ¯ä¼˜åŠ¿
- **ç±»å‹å®‰å…¨ï¼š** Rustç±»å‹ç³»ç»Ÿä¿è¯å†…å­˜å’Œçº¿ç¨‹å®‰å…¨
- **é«˜æ€§èƒ½ï¼š** å¹¶è¡Œå¤„ç†å’Œç¼“å­˜ä¼˜åŒ–
- **æ¨¡å—åŒ–ï¼š** æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»å’ŒèŒè´£åˆ’åˆ†
- **å¯æ‰©å±•ï¼š** æ’ä»¶ç³»ç»Ÿå’Œæ ‡å‡†åŒ–æ¥å£

### æ¶æ„ä¼˜åŠ¿
- **åˆ†å±‚è®¾è®¡ï¼š** æ¸…æ™°çš„æ¶æ„å±‚æ¬¡
- **æ¾è€¦åˆï¼š** æ¨¡å—é—´ä¾èµ–æœ€å°åŒ–
- **é«˜å†…èšï¼š** æ¨¡å—å†…åŠŸèƒ½ç´§å¯†ç›¸å…³
- **å¯æµ‹è¯•ï¼š** å®Œæ•´çš„æµ‹è¯•è¦†ç›–

### ç»´æŠ¤ä¼˜åŠ¿
- **ä»£ç è´¨é‡ï¼š** ä¸¥æ ¼çš„ä»£ç è§„èŒƒ
- **æ–‡æ¡£å®Œæ•´ï¼š** è¯¦ç»†çš„è®¾è®¡å’ŒAPIæ–‡æ¡£
- **æµ‹è¯•è¦†ç›–ï¼š** 95%+çš„æµ‹è¯•è¦†ç›–ç‡
- **æŒç»­é›†æˆï¼š** è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ„å»º

PSOCé¡¹ç›®çš„æ¶æ„è®¾è®¡ä¸ºæ„å»ºä¸“ä¸šçº§å›¾åƒç¼–è¾‘è½¯ä»¶æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ” è¯¦ç»†æ¨¡å—åˆ†æ

### Crateä¾èµ–å…³ç³»

#### psoc-core (æ ¸å¿ƒåº“)
**èŒè´£ï¼š** æä¾›åŸºç¡€æ•°æ®ç»“æ„å’Œç®—æ³•
**ä¸»è¦æ¨¡å—ï¼š**
- `document.rs` - æ–‡æ¡£æ•°æ®ç»“æ„
- `layer.rs` - å›¾å±‚ç³»ç»Ÿ
- `pixel.rs` - åƒç´ æ•°æ®å¤„ç†
- `geometry.rs` - å‡ ä½•è®¡ç®—
- `color.rs` - é¢œè‰²ç®¡ç†
- `command.rs` - å‘½ä»¤ç³»ç»Ÿ
- `rendering.rs` - æ¸²æŸ“å¼•æ“
- `smart_object.rs` - æ™ºèƒ½å¯¹è±¡
- `selection.rs` - é€‰åŒºç³»ç»Ÿ
- `adjustment.rs` - è°ƒæ•´ç³»ç»Ÿ

**ä¾èµ–ï¼š** ä»…ä¾èµ–åŸºç¡€åº“ï¼ˆserde, uuid, anyhowç­‰ï¼‰

#### psoc-image-processing (å›¾åƒå¤„ç†åº“)
**èŒè´£ï¼š** å›¾åƒå¤„ç†ç®—æ³•å®ç°
**ä¸»è¦åŠŸèƒ½ï¼š**
- æ»¤é•œç®—æ³•ï¼ˆé«˜æ–¯æ¨¡ç³Šã€é”åŒ–ã€å™ªç‚¹ç­‰ï¼‰
- å˜æ¢ç®—æ³•ï¼ˆç¼©æ”¾ã€æ—‹è½¬ã€é€è§†ç­‰ï¼‰
- é¢œè‰²è°ƒæ•´ç®—æ³•ï¼ˆäº®åº¦ã€å¯¹æ¯”åº¦ã€HSLç­‰ï¼‰
- é€‰åŒºç®—æ³•ï¼ˆé­”æ£’ã€è¾¹ç¼˜æ£€æµ‹ç­‰ï¼‰

**ä¾èµ–ï¼š** psoc-core, image, rayon

#### psoc-file-formats (æ–‡ä»¶æ ¼å¼åº“)
**èŒè´£ï¼š** æ–‡ä»¶æ ¼å¼æ”¯æŒ
**æ”¯æŒæ ¼å¼ï¼š**
- PNG - å®Œæ•´æ”¯æŒï¼ŒICCé…ç½®æ–‡ä»¶
- JPEG - å®Œæ•´æ”¯æŒï¼ŒEXIFæ•°æ®
- TIFF - åŸºç¡€æ”¯æŒ
- WebP - åŸºç¡€æ”¯æŒ
- .psoc - é¡¹ç›®æ–‡ä»¶æ ¼å¼ï¼ˆRONï¼‰

**ä¾èµ–ï¼š** psoc-core, image, serde

#### psoc-ui-toolkit (UIç»„ä»¶åº“)
**èŒè´£ï¼š** å¯å¤ç”¨UIç»„ä»¶
**ä¸»è¦ç»„ä»¶ï¼š**
- é¢œè‰²é€‰æ‹©å™¨
- æ»‘å—æ§ä»¶
- æ•°å€¼è¾“å…¥æ¡†
- å›¾å±‚é¢æ¿
- å·¥å…·é€‰é¡¹é¢æ¿

**ä¾èµ–ï¼š** iced, psoc-core

#### psoc-plugins (æ’ä»¶ç³»ç»Ÿ)
**èŒè´£ï¼š** æ’ä»¶æ¶æ„å’Œè„šæœ¬æ”¯æŒ
**åŠŸèƒ½ï¼š**
- æ’ä»¶APIå®šä¹‰
- åŠ¨æ€åº“åŠ è½½
- Luaè„šæœ¬å¼•æ“
- WASMè¿è¡Œæ—¶
- æ’ä»¶ç®¡ç†å™¨

**ä¾èµ–ï¼š** psoc-core, mlua, wasmtime

### æ ¸å¿ƒç®—æ³•å®ç°

#### å›¾å±‚åˆæˆç®—æ³•
```rust
// ç®€åŒ–çš„å›¾å±‚åˆæˆæµç¨‹
fn composite_layers(layers: &[Layer], bounds: Rect) -> PixelData {
    let mut result = PixelData::new(bounds.width(), bounds.height());

    for layer in layers.iter().filter(|l| l.visible) {
        let layer_data = render_layer(layer, bounds);
        blend_layer(&mut result, &layer_data, layer.blend_mode, layer.opacity);
    }

    result
}
```

#### æ™ºèƒ½å¯¹è±¡ç¼“å­˜
```rust
// LRUç¼“å­˜å®ç°
pub struct SmartObjectManager {
    cache: LruCache<ContentHash, RenderedContent>,
    max_cache_size: usize,
}

impl SmartObjectManager {
    fn get_rendered_content(&mut self, content: &SmartObjectContent) -> &RenderedContent {
        let hash = content.hash();

        if !self.cache.contains(&hash) {
            let rendered = self.render_content(content);
            self.cache.put(hash, rendered);
        }

        self.cache.get(&hash).unwrap()
    }
}
```

#### å¹¶è¡Œæ¸²æŸ“
```rust
// ç“¦ç‰‡åŒ–å¹¶è¡Œæ¸²æŸ“
fn render_parallel(document: &Document, bounds: Rect) -> PixelData {
    let tile_size = 256;
    let tiles: Vec<_> = bounds.tiles(tile_size).collect();

    let rendered_tiles: Vec<_> = tiles
        .par_iter()
        .map(|tile_bounds| render_tile(document, *tile_bounds))
        .collect();

    combine_tiles(rendered_tiles, bounds)
}
```

## ğŸ¨ ç”¨æˆ·ç•Œé¢æ¶æ„

### Icedåº”ç”¨ç¨‹åºç»“æ„
```rust
// ä¸»åº”ç”¨ç¨‹åºçŠ¶æ€
pub struct PsocApp {
    // æ ¸å¿ƒçŠ¶æ€
    state: AppState,
    document: Option<Document>,
    tool_manager: ToolManager,

    // UIçŠ¶æ€
    theme: PsocTheme,
    canvas_state: CanvasState,
    panel_states: PanelStates,

    // å¯¹è¯æ¡†
    dialogs: DialogManager,

    // å›½é™…åŒ–
    i18n: I18nManager,
}

// æ¶ˆæ¯ç³»ç»Ÿ
#[derive(Debug, Clone)]
pub enum Message {
    // æ–‡ä»¶æ“ä½œ
    FileNew,
    FileOpen,
    FileSave,

    // ç¼–è¾‘æ“ä½œ
    Undo,
    Redo,
    Copy,
    Paste,

    // å·¥å…·æ“ä½œ
    ToolSelected(ToolType),
    ToolOption(ToolOptionMessage),

    // å›¾å±‚æ“ä½œ
    Layer(LayerMessage),

    // ç”»å¸ƒæ“ä½œ
    Canvas(CanvasMessage),

    // å¯¹è¯æ¡†
    Dialog(DialogMessage),
}
```

### å“åº”å¼å¸ƒå±€
```rust
fn view(&self) -> Element<Message> {
    column![
        self.menu_bar(),           // èœå•æ 
        self.toolbar(),            // å·¥å…·æ 
        row![
            self.tool_panel(),     // å·¥å…·é¢æ¿
            self.canvas_area(),    // ç”»å¸ƒåŒºåŸŸ
            self.properties_panel(), // å±æ€§é¢æ¿
        ].spacing(4),
        self.status_bar(),         // çŠ¶æ€æ 
    ].spacing(0)
}
```

## ğŸ”§ å·¥å…·ç³»ç»Ÿè¯¦ç»†è®¾è®¡

### å·¥å…·ç”Ÿå‘½å‘¨æœŸ
1. **æ³¨å†Œï¼š** å·¥å…·åœ¨ToolManagerä¸­æ³¨å†Œ
2. **æ¿€æ´»ï¼š** ç”¨æˆ·é€‰æ‹©å·¥å…·ï¼Œè°ƒç”¨activate()
3. **äº‹ä»¶å¤„ç†ï¼š** å¤„ç†é¼ æ ‡ã€é”®ç›˜äº‹ä»¶
4. **é€‰é¡¹æ›´æ–°ï¼š** åŠ¨æ€æ›´æ–°å·¥å…·é€‰é¡¹
5. **åœç”¨ï¼š** åˆ‡æ¢åˆ°å…¶ä»–å·¥å…·ï¼Œè°ƒç”¨deactivate()

### å·¥å…·äº‹ä»¶æµ
```rust
// äº‹ä»¶å¤„ç†æµç¨‹
UI Event â†’ ToolManager â†’ Active Tool â†’ Command Generation â†’ Document Update â†’ UI Refresh
```

### å·¥å…·é€‰é¡¹ç³»ç»Ÿ
```rust
// å·¥å…·é€‰é¡¹å®šä¹‰
pub struct ToolOption {
    pub name: String,              // é€‰é¡¹åç§°
    pub display_name: String,      // æ˜¾ç¤ºåç§°
    pub description: String,       // æè¿°
    pub option_type: ToolOptionType, // é€‰é¡¹ç±»å‹
    pub default_value: ToolOptionValue, // é»˜è®¤å€¼
}

// é€‰é¡¹ç±»å‹
pub enum ToolOptionType {
    Bool,                          // å¸ƒå°”å€¼
    Int { min: i32, max: i32 },   // æ•´æ•°èŒƒå›´
    Float { min: f32, max: f32 }, // æµ®ç‚¹æ•°èŒƒå›´
    Color,                         // é¢œè‰²
    Enum(Vec<String>),            // æšä¸¾
    String,                        // å­—ç¬¦ä¸²
}
```

## ğŸ“Š æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

### æ€§èƒ½æŒ‡æ ‡
- **å¯åŠ¨æ—¶é—´ï¼š** < 2ç§’
- **æ–‡ä»¶åŠ è½½ï¼š** å¤§æ–‡ä»¶ < 5ç§’
- **å·¥å…·å“åº”ï¼š** < 100ms
- **æ¸²æŸ“å¸§ç‡ï¼š** 60fps
- **å†…å­˜ä½¿ç”¨ï¼š** < 100MBåŸºç¡€å ç”¨

### ä¼˜åŒ–ç­–ç•¥
1. **é¢„åŠ è½½ï¼š** å¸¸ç”¨èµ„æºé¢„åŠ è½½
2. **æ‡’åŠ è½½ï¼š** æŒ‰éœ€åŠ è½½åŠŸèƒ½æ¨¡å—
3. **ç¼“å­˜ï¼š** å¤šçº§ç¼“å­˜ç­–ç•¥
4. **å¹¶è¡Œï¼š** CPUå¯†é›†ä»»åŠ¡å¹¶è¡ŒåŒ–
5. **SIMDï¼š** å‘é‡åŒ–å›¾åƒå¤„ç†

### å†…å­˜ç®¡ç†
```rust
// æ™ºèƒ½æŒ‡é’ˆä½¿ç”¨
Arc<Document>          // æ–‡æ¡£å…±äº«
Rc<RefCell<Layer>>     // å›¾å±‚å¯å˜å€Ÿç”¨
Box<dyn Tool>          // å·¥å…·å¤šæ€
Cow<'_, str>           // å­—ç¬¦ä¸²ä¼˜åŒ–
```

## ğŸŒ å›½é™…åŒ–è®¾è®¡

### å¤šè¯­è¨€æ”¯æŒ
- **æ¡†æ¶ï¼š** Fluentå›½é™…åŒ–æ¡†æ¶
- **è¯­è¨€ï¼š** è‹±æ–‡ã€ç®€ä½“ä¸­æ–‡
- **èµ„æºï¼š** .ftlæ–‡ä»¶æ ¼å¼
- **åŠ¨æ€åˆ‡æ¢ï¼š** è¿è¡Œæ—¶è¯­è¨€åˆ‡æ¢

### æœ¬åœ°åŒ–å†…å®¹
- UIæ–‡æœ¬ç¿»è¯‘
- é”™è¯¯æ¶ˆæ¯æœ¬åœ°åŒ–
- æ—¥æœŸæ—¶é—´æ ¼å¼
- æ•°å­—æ ¼å¼
- æ–‡åŒ–ç›¸å…³åŠŸèƒ½

## ğŸ”’ å®‰å…¨æ€§è®¾è®¡

### å†…å­˜å®‰å…¨
- **Rustä¿è¯ï¼š** æ— ç©ºæŒ‡é’ˆã€æ— ç¼“å†²åŒºæº¢å‡º
- **å€Ÿç”¨æ£€æŸ¥ï¼š** ç¼–è¯‘æ—¶å†…å­˜å®‰å…¨
- **çº¿ç¨‹å®‰å…¨ï¼š** Send/Sync traitä¿è¯

### æ–‡ä»¶å®‰å…¨
- **è·¯å¾„éªŒè¯ï¼š** é˜²æ­¢è·¯å¾„éå†æ”»å‡»
- **æ ¼å¼éªŒè¯ï¼š** ä¸¥æ ¼çš„æ–‡ä»¶æ ¼å¼æ£€æŸ¥
- **å¤§å°é™åˆ¶ï¼š** é˜²æ­¢å†…å­˜è€—å°½æ”»å‡»
- **æƒé™æ£€æŸ¥ï¼š** æ–‡ä»¶è®¿é—®æƒé™éªŒè¯

### æ’ä»¶å®‰å…¨
- **æ²™ç®±ï¼š** WASMå®‰å…¨æ‰§è¡Œç¯å¢ƒ
- **æƒé™æ§åˆ¶ï¼š** ç»†ç²’åº¦æƒé™ç®¡ç†
- **APIé™åˆ¶ï¼š** å—é™çš„æ’ä»¶API
- **ä»£ç ç­¾åï¼š** æ’ä»¶å®Œæ•´æ€§éªŒè¯

## ğŸ“ˆ å¯æ‰©å±•æ€§å®ç°

### æ’ä»¶æ¶æ„
```rust
// æ’ä»¶æ¥å£
pub trait Plugin: Send + Sync {
    fn name(&self) -> &str;
    fn version(&self) -> &str;
    fn initialize(&mut self, api: &PluginApi) -> Result<()>;
    fn execute(&self, context: &PluginContext) -> Result<PluginResult>;
}

// æ’ä»¶API
pub struct PluginApi {
    document_api: DocumentApi,
    tool_api: ToolApi,
    ui_api: UiApi,
}
```

### åŠŸèƒ½æ‰©å±•ç‚¹
1. **å·¥å…·æ‰©å±•ï¼š** è‡ªå®šä¹‰å·¥å…·æ’ä»¶
2. **æ»¤é•œæ‰©å±•ï¼š** è‡ªå®šä¹‰æ»¤é•œç®—æ³•
3. **æ ¼å¼æ‰©å±•ï¼š** æ–°æ–‡ä»¶æ ¼å¼æ”¯æŒ
4. **UIæ‰©å±•ï¼š** è‡ªå®šä¹‰é¢æ¿å’Œå¯¹è¯æ¡†
5. **è„šæœ¬æ‰©å±•ï¼š** Luaè„šæœ¬è‡ªåŠ¨åŒ–

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•åˆ†å±‚
1. **å•å…ƒæµ‹è¯•ï¼š** æ¨¡å—çº§åŠŸèƒ½æµ‹è¯•
2. **é›†æˆæµ‹è¯•ï¼š** æ¨¡å—é—´åä½œæµ‹è¯•
3. **ç«¯åˆ°ç«¯æµ‹è¯•ï¼š** å®Œæ•´åŠŸèƒ½æµç¨‹æµ‹è¯•
4. **æ€§èƒ½æµ‹è¯•ï¼š** åŸºå‡†æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•
5. **UIæµ‹è¯•ï¼š** ç”¨æˆ·ç•Œé¢äº¤äº’æµ‹è¯•

### æµ‹è¯•å·¥å…·
- **Rustå†…ç½®ï¼š** æ ‡å‡†æµ‹è¯•æ¡†æ¶
- **Criterionï¼š** æ€§èƒ½åŸºå‡†æµ‹è¯•
- **Proptestï¼š** å±æ€§æµ‹è¯•
- **Mockï¼š** ä¾èµ–æ¨¡æ‹Ÿ
- **Coverageï¼š** ä»£ç è¦†ç›–ç‡

## ğŸ“‹ å¼€å‘å·¥ä½œæµ

### ä»£ç è´¨é‡ä¿è¯
1. **é™æ€åˆ†æï¼š** Clippyæ£€æŸ¥
2. **æ ¼å¼åŒ–ï¼š** rustfmtè‡ªåŠ¨æ ¼å¼åŒ–
3. **æ–‡æ¡£ï¼š** å¼ºåˆ¶APIæ–‡æ¡£
4. **æµ‹è¯•ï¼š** 95%+è¦†ç›–ç‡è¦æ±‚
5. **å®¡æŸ¥ï¼š** ä»£ç å®¡æŸ¥æµç¨‹

### æŒç»­é›†æˆ
1. **æ„å»ºï¼š** å¤šå¹³å°è‡ªåŠ¨æ„å»º
2. **æµ‹è¯•ï¼š** è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ
3. **è´¨é‡ï¼š** ä»£ç è´¨é‡æ£€æŸ¥
4. **æ‰“åŒ…ï¼š** è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒ
5. **éƒ¨ç½²ï¼š** è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†PSOCé¡¹ç›®çš„æŠ€æœ¯å…ˆè¿›æ€§ã€ä»£ç è´¨é‡å’Œé•¿æœŸå¯ç»´æŠ¤æ€§ï¼Œä¸ºæ„å»ºä¸–ç•Œçº§çš„å›¾åƒç¼–è¾‘è½¯ä»¶å¥ å®šäº†åšå®åŸºç¡€ã€‚
